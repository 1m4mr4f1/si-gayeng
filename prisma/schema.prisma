// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// 1. ADMIN
model Admin {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  nama      String
  createdAt DateTime @default(now())
  
  events    Event[]

  @@map("admin")
}

// 2. MITRA
model Mitra {
  id               Int      @id @default(autoincrement())
  email            String   @unique
  password         String
  namaUsaha        String   
  
  // Data Profil & Lokasi
  deskripsi        String?  @db.Text
  alamat           String?
  kecamatan        String?
  noHp             String?
  kategori         String?  // Kuliner, Fashion, Kerajinan
  
  latitude         Float?
  longitude        Float?
  
  fotoProfil       String?
  statusVerifikasi Boolean  @default(false) 
  statusBuka       Boolean  @default(true)
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  produk           Produk[]      
  sertifikasi      Sertifikasi[] // Relasi One-to-Many ke Sertifikasi

  @@map("mitra")
}

// 3. PRODUK
model Produk {
  id          Int      @id @default(autoincrement())
  namaProduk  String
  harga       Decimal  @db.Decimal(10, 2)
  deskripsi   String?
  fotoProduk  String?
  
  mitraId     Int
  mitra       Mitra    @relation(fields: [mitraId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("produk")
}

// 4. EVENT
model Event {
  id          Int      @id @default(autoincrement())
  judul       String
  deskripsi   String   @db.Text
  tanggal     DateTime
  lokasi      String
  bannerUrl   String?
  
  adminId     Int
  admin       Admin    @relation(fields: [adminId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("event")
}

// 5. SERTIFIKASI (Pengajuan Legalitas)
model Sertifikasi {
  id              Int      @id @default(autoincrement())
  jenis           String   // Contoh: "PIRT", "HALAL", "BPOM"
  status          String   @default("PENDING") // PENDING, APPROVED, REJECTED
  
  // 1. Input dari Mitra (Saat Mengajukan)
  dokumenMitra    String?  // URL foto bukti pengajuan/dokumen pendukung
  
  // 2. Input dari Admin (Saat Verifikasi/Approval)
  nomorSertifikat String?  // PENTING: Untuk menyimpan nomornya (misal: ID33110000)
  sertifikatResmi String?  // URL foto sertifikat fisik (jika ada)
  catatan         String?  // Alasan jika DITOLAK atau info tambahan
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  mitraId         Int
  mitra           Mitra    @relation(fields: [mitraId], references: [id], onDelete: Cascade)

  @@map("sertifikasi")
}